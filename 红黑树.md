# 二叉搜索树

## 查找（类似于二分查找）

## 插入

需要找到插入位置！和查找类似，从根节点开始比较，小于根节点则与左节点比较，大于则与右节点比较。**直到左子树为空或者右子树为空，插入到这个空的位置**。

## 删除

先查找到被删除元素e的位置

- 如果e叶子节点，那么直接删除
- 如果e只有左孩子或者只有右孩子，那么直接删除，并且把它的孩子加到删除的位置。
- 如果e既有左孩子又有右孩子，那么找到它的**后继节点**（即中序遍历中它的后一个节点），这个节点被后继节点取代，然后删除后继结点！

删除很复杂，需要调整结构，没有太大必要，一般都是使用逻辑删除。



`缺陷`：极端情况下退化为链表



# AVL树（平衡二叉搜索树）

在二叉搜索树的基础上增加了左右子树高度差不大于1。





`缺陷`：高度差不大于1这个要求太严格了，调整的时候左旋右旋操作频繁！

# 红黑树

## 原理

![image-20200716190951670](D:\Typora\picture\image-20200716190951670.png)

性质

1. 节点要么是红色，要么是黑色

2. 根节点是黑色

3. 每个叶子节点（NIL）是黑色

4. 不能有连续红色节点！ 

5. 任意一个节点到达每个叶子节点的路径都包含**相同数量**的**黑节点**，俗称“**黑高**”

   由5推出：如果一个节点存在黑子节点，那么该节点肯定有两个子节点。



红黑树的自平衡，靠的是**左旋**、**右旋**和**变色**！

左旋和右旋主要就是那两个动态图。

![img](https://img-blog.csdnimg.cn/20181125155223734.gif)

![img](https://img-blog.csdnimg.cn/20181125160017452.gif)

## 查找

和二叉搜索树一样的

## 插入

步骤：

1. 和二叉树一样，找到插入的位置
2. **`自平衡操作！`**

首先，插入的必须是<font color='red'>**红色**</font>，这样有的情况下可以不用调整，如果是黑色，则一定会破坏平衡

**情况分析**：

### 1. 红黑树为空树

直接插入节点作为根节点，然后把根节点染为黑色！

### 2.  插入节点的key已存在

更新当前节点的值为插入节点的值

### 3.  插入节点的父节点是黑色

由于插入的是红色节点，因此不会影响平衡，直接插入即可！

### 4. 插入节点的父节点是红色

可知它的父节点一定不是根节点，而且爷爷节点是黑色，因此三代的关系是黑->红->红

继续分类讨论：

#### 4.1 叔叔节点存在，并且为红色

处理方法：

- 将爸爸和叔叔设置为黑色

- 将爷爷设置为红色
- 把爷爷设置为当前插入节点，进行后续处理

![img](https://upload-images.jianshu.io/upload_images/2392382-9f2c746bf0769f49.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

如果PP节点父节点就是黑色，那么不用做处理

如果PP节点父节点是红色，那么把PP作为插入节点，做自平衡处理

如果PP节点是根节点，那么必须染色为黑色，这是**唯一会增加叶子节点到根节点黑色节点个数的情形**

#### 4.2 叔叔节点不存在或者是黑色，并且插入结点的父亲结点是祖父结点的左子结点

![image-20200716210708636](D:\Typora\picture\image-20200716210708636.png)

##### 4.2.1 新插入节点，是其父节点的左节点（LL双红）

操作：

- 变颜色：爸爸设置为黑色，爷爷设置为红色
- 对爷爷进行右旋操作！

![img](https://upload-images.jianshu.io/upload_images/2392382-ab4097b750826870.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

##### 4.2.2 新插入节点，是其父节点的右节点（LR双红）

操作：

- 对P左旋操作
- 设置P为插入节点，**得到4.2.1的LL双红情况**
- 依据4.2.1进行操作（1. 变色 2. 右旋）

![img](https://upload-images.jianshu.io/upload_images/2392382-fbfc4f299941cb8b.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

#### 4.3 叔叔结点不存在或为黑结点，并且插入结点的父亲结点是祖父结点的右子结点

其实就是4.2的反方向

![image-20200716211602410](D:\Typora\picture\image-20200716211602410.png)

##### 4.3.1 新插入结点，是父结点的右节点（RR双红）

- 将P设为黑色
- 将PP设为红色
- 对PP进行左旋

![img](https://upload-images.jianshu.io/upload_images/2392382-2bc24a78b68dae51.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

##### 4.3.2 新插入结点，是其父结点的左节点（RL双红）

- 对P进行右旋
- 把P设置为插入结点，得到情景4.3.1
- 进行情景4.3.1的处理（染色、左旋）

![img](https://upload-images.jianshu.io/upload_images/2392382-ee1a9027ddcc210a.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

## 删除

步骤：

- 找到目标节点，删除
- 自平衡操作

**三种情形**：

1. 删除节点无子节点，直接删除
2. 删除节点只有一个子节点，**用子节点替换删除节点**
3. 删除节点有两个节点，**用后继节点替换删除节点**

**重要思路**：

**<font color='blue'>删除结点被替代后，在不考虑结点的键值的情况下，对于树来说，可以认为删除的是替代结点！而替代结点最后总是在树末。</font>**

![img](https://upload-images.jianshu.io/upload_images/2392382-f45799daa674d0ad.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

删除P，实际上删除的是Q的位置！

因此，上面的2、3种情况都能转换为1。

2：删除结点用其唯一的子结点替换，子结点替换为删除结点后，可以认为删除的是子结点，若子结点又有两个子结点，那么相当于转换为情景3，一直自顶向下转换，总是能转换为1。（对于红黑树来说，根据性质5.1，只存在一个子结点的结点肯定在树末了）

3：删除结点用后继结点（肯定不存在左结点，如果存在，后继就是那个左节点），如果后继结点有右子结点，那么相当于转换为2，否则转为1。

所以，我们只要考虑**替换节点**的删除即可

### 1. 替换节点是红色

删除红色的叶子节点，不会破坏平衡，因此把替换节点的颜色设置为删除节点的颜色即可！

### 2. 替换节点是黑色

#### 2.1 替换节点是其父节点的左节点

##### 2.1.1 替换节点的兄弟节点是黑色

###### 2.1.1.1  替换节点的兄弟节点的右节点是红色，左节点任意颜色

- **将S的颜色设为P的颜色**
- **将P设为黑色**
- **将SR设为黑色**
- **对P进行左旋**

![img](https://upload-images.jianshu.io/upload_images/2392382-7eea721cbb855876.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

R之后会被替换上去，因此可以看作是删除的。

###### 2.1.1.2  替换结点的兄弟结点的右子结点为黑色，左子结点为红色

- **将S设为红色**
- **将SL设为黑色**
- **对S进行右旋，得到情景2.1.1.1**
- **进行情景2.1.1.1的处理**

![img](https://upload-images.jianshu.io/upload_images/2392382-dc29605ce9889973.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

###### 2.1.1.3  替换结点的兄弟结点的子结点都为黑色

- **将S设为红色**
- **把P作为新的替换结点**
- **重新进行删除结点情景处理**

![img](https://upload-images.jianshu.io/upload_images/2392382-75293515d8d87024.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

#### 2.1.2 替换节点的兄弟节点是红色

兄弟结点的父结点和子结点肯定为黑色

- **将S设为黑色**
- **将P设为红色**
- **对P进行左旋，得到情景2.1.1.3**
- **进行情景2.1.1.3的处理**

![img](https://upload-images.jianshu.io/upload_images/2392382-1e4c3388491b588f.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

### 2.2 替换节点是其父节点的右节点

和左边的操作是相反的

#### 2.2.1  替换结点的兄弟结点是黑色

###### 2.2.1.1  替换结点的兄弟结点的左子结点是红色，右子结点任意颜色

- **将S的颜色设为P的颜色**
- **将P设为黑色**
- **将SL设为黑色**
- **对P进行右旋**

![img](https://upload-images.jianshu.io/upload_images/2392382-b1ea52c823ce0b0b.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

###### 2.2.1.2  替换结点的兄弟结点的左子结点为黑色，右子结点为红色

- **将S设为红色**
- **将SR设为黑色**
- **对S进行左旋，得到情景2.2.1.1**
- **进行情景2.2.1.1的处理**

![img](https://upload-images.jianshu.io/upload_images/2392382-edcb4ea6ac87e342.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

###### 2.2.1.3  替换结点的兄弟结点的子结点都为黑色

- **将S设为红色**
- **把P作为新的替换结点**
- **重新进行删除结点情景处理**

![img](https://upload-images.jianshu.io/upload_images/2392382-6559c4cccf3df81c.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)

##### 2.2.2  替换节点的兄弟节点是红色

- **将S设为黑色**
- **将P设为红色**
- **对P进行右旋，得到情景2.2.1.3**
- **进行情景2.2.1.3的处理**

![img](https://upload-images.jianshu.io/upload_images/2392382-387664c771b21f1b.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp)